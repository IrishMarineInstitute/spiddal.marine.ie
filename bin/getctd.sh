#!/bin/sh
chmod 664 /home/dmuser/sites/spiddal.marine.ie/html/data/spiddal-ctd.json.new
curl -s --header "Host: ctd.gconode01.dm.marine.ie" cluster01 | python -c 'import sys,json,datetime;  timestamp = datetime.datetime.utcnow().isoformat()[:-3]+"Z"; [Press,Temp,Cond,Sal,SoundV,DissolvedOxygenPPM,DissolvedOxygenSat,Time] = json.load(sys.stdin)["message"].split("|")[2].strip().split(); print json.dumps({"Press": float(Press),"Temp": float(Temp), "Cond": float(Cond), "Sal": float(Sal), "SoundV": float(SoundV), "DissolvedOxygenPPM": float(DissolvedOxygenPPM), "DissolvedOxygenSat": float(DissolvedOxygenSat), "Time": Time, "Timestamp": timestamp})' > /home/dmuser/sites/spiddal.marine.ie/html/data/spiddal-ctd.json.new && chmod 664 /home/dmuser/sites/spiddal.marine.ie/html/data/spiddal-ctd.json.new && mv /home/dmuser/sites/spiddal.marine.ie/html/data/spiddal-ctd.json.new /home/dmuser/sites/spiddal.marine.ie/html/data/spiddal-ctd.json
